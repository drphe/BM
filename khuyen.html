<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Biá»ƒu Ä‘á»“ Highcharts TÃ¹y Biáº¿n</title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <style>
        #controls {
            margin-bottom: 20px;
        }

        select,
        button {
            margin-right: 10px;
            padding: 6px 10px;
            cursor: pointer;
        }

        #days button.active {
            background-color: #0066cc;
            color: white;
        }

        #container {
            width: 100%;
            height: 400px;
        }
    </style>
</head>

<body>
    <div id="controls" style="display:flex">
        <select id="type">
            <option value="1">Khuyáº¿n nghá»‹ mua</option>
            <option value="2">Khuyáº¿n nghá»‹ bÃ¡n</option>
            <option value="3">Top upside hiá»‡n táº¡i</option>
            <option value="4">Top upside tÄƒng trÆ°á»Ÿng LNDP</option>
        </select>

        <div id="days">
            <button data-value="30D">30D</button>
            <button data-value="60D">60D</button>
            <button data-value="90D"  class="active">90D</button>
            <button data-value="180D">180D</button>
        </div>
    </div>

    <div id="container"></div>

    <script>
        let currentDay = "90D";
        let currentType = document.getElementById("type").value;

        async function loadChart() {
            const url = `https://api.alphastock.vn/api/report/top?days=${currentDay}&type=${currentType}`;

            try {
                const response = await fetch(url);
                const rawData = await response.json();

                const categories = rawData.map(item => item.code);
                const seriesData = rawData.map(item => {
                    const tooltip = item.tooltip.map(row => `${row.source}: ${row.date}`).join('<br/>');
                    return {
                        name: item.code,
                        y: item.value,
                        tooltipData: tooltip
                    };
                });

                Highcharts.chart('container', {
                    chart: {
                        type: 'bar'
                    },
                    title: {
                        text: ''
                    },
                    xAxis: {
                        categories: categories,
                        visible: true,
                        title: {
                            text: ''
                        },
                        labels: {
                            style: {
                                fontWeight: 'bold',
                                fontSize: '14px'
                            }
                        }
                    },

                    legend: {
                        enabled: false
                    }, // ðŸ”’ áº¨n legend
                    credits: {
                        enabled: false
                    }, // ðŸ”’ áº¨n credit
                    yAxis: {
                        visible: false,
                        title: {
                            text: ''
                        }
                    },

                    plotOptions: {
                        series: {
                            dataLabels: {
                                enabled: true,
                                formatter: function() {
                                    if (currentType === "3" || currentType === "4") {
                                        return Highcharts.numberFormat(this.y, 2) + ' %';
                                    } else {
                                        return this.y + ' láº§n';
                                    }
                                }
                            }
                        }
                    },

                    tooltip: {
                        useHTML: true,
                        formatter: function() {
                            const label = (currentType === "3" || currentType === "4") ?
                                Highcharts.numberFormat(this.y, 2) + ' %' :
                                this.y + ' láº§n';
                            return `<b>Nguá»“n dá»¯ liá»‡u</b><br/>${this.point.tooltipData}`;
                        }
                    },
                    series: [{
                        name: 'Khuyáº¿n nghá»‹',
                        data: seriesData
                    }]
                });

            } catch (err) {
                alert("Lá»—i khi táº£i dá»¯ liá»‡u. Kiá»ƒm tra káº¿t ná»‘i hoáº·c API.");
                console.error(err);
            }
        }

        // ðŸ”„ Sá»± kiá»‡n cáº­p nháº­t khi thay Ä‘á»•i type
        document.getElementById("type").addEventListener("change", function() {
            currentType = this.value;
            loadChart();
        });

        // ðŸ”„ Sá»± kiá»‡n khi click vÃ o nÃºt day
        document.querySelectorAll("#days button").forEach(btn => {
            btn.addEventListener("click", function() {
                document.querySelectorAll("#days button").forEach(b => b.classList.remove("active"));
                this.classList.add("active");
                currentDay = this.getAttribute("data-value");
                loadChart();
            });
        });

        window.onload = loadChart;
    </script>
</body>

</html>